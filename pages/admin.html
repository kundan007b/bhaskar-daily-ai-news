---
layout: default
title: Admin - Upload Article
permalink: /admin/
robots: noindex, nofollow
---

<div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    
    <!-- Security Warning -->
    <div class="mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg">
      <p class="text-amber-800 text-sm">
        <strong>‚ö†Ô∏è Security Note:</strong> This admin page uses client-side authentication for convenience. 
        For production use, consider implementing server-side auth or GitHub OAuth. 
        Never share your GitHub Personal Access Token publicly.
      </p>
    </div>
    
    <!-- Login Section -->
    <div id="loginSection" class="bg-white rounded-lg shadow-md p-8">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Admin Login</h1>
        <p class="text-gray-600">Upload articles directly to your blog</p>
      </div>
      
      <div class="max-w-md mx-auto">
        <div class="mb-4">
          <label for="userId" class="block text-sm font-medium text-gray-700 mb-2">User ID</label>
          <input type="text" id="userId" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter user ID">
        </div>
        
        <div class="mb-6">
          <label for="password" class="block text-sm font-medium text-gray-700 mb-2">Password</label>
          <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter password">
        </div>
        
        <div id="loginError" class="hidden mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm"></div>
        
        <button onclick="login()" class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
          Login
        </button>
      </div>
    </div>

    <!-- Upload Section -->
    <div id="uploadSection" class="hidden bg-white rounded-lg shadow-md p-8">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Upload New Article</h1>
        <button onclick="logout()" class="text-red-600 hover:text-red-800 font-medium">Logout</button>
      </div>
      
      <form id="articleForm" class="space-y-6">
        <!-- Title -->
        <div>
          <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Article Title *</label>
          <input type="text" id="title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter article title">
        </div>

        <!-- Slug -->
        <div>
          <label for="slug" class="block text-sm font-medium text-gray-700 mb-2">URL Slug *</label>
          <input type="text" id="slug" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="article-url-slug">
          <p class="mt-1 text-sm text-gray-500">Will create: YYYY-MM-DD-article-url-slug.md</p>
        </div>

        <!-- Author -->
        <div>
          <label for="author" class="block text-sm font-medium text-gray-700 mb-2">Author *</label>
          <select id="author" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="">Select Author</option>
            <option value="rajesh-kumar">Rajesh Kumar</option>
            <option value="ananya-singh">Ananya Singh</option>
          </select>
        </div>

        <!-- Categories -->
        <div>
          <label for="categories" class="block text-sm font-medium text-gray-700 mb-2">Categories *</label>
          <div class="grid grid-cols-2 gap-3">
            <label class="flex items-center">
              <input type="checkbox" name="category" value="AI" class="mr-2">
              <span class="text-sm">AI</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" name="category" value="Startups" class="mr-2">
              <span class="text-sm">Startups</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" name="category" value="Gadgets" class="mr-2">
              <span class="text-sm">Gadgets</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" name="category" value="Cybersecurity" class="mr-2">
              <span class="text-sm">Cybersecurity</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" name="category" value="Cloud Computing" class="mr-2">
              <span class="text-sm">Cloud Computing</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" name="category" value="Technology" class="mr-2">
              <span class="text-sm">Technology</span>
            </label>
          </div>
        </div>

        <!-- Language -->
        <div>
          <label for="language" class="block text-sm font-medium text-gray-700 mb-2">Language *</label>
          <select id="language" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <option value="en">English</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
          </select>
        </div>

        <!-- News Keywords -->
        <div>
          <label for="keywords" class="block text-sm font-medium text-gray-700 mb-2">News Keywords</label>
          <input type="text" id="keywords" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="AI, technology, India (comma separated)">
        </div>

        <!-- Image URL -->
        <div>
          <label for="image" class="block text-sm font-medium text-gray-700 mb-2">Featured Image URL</label>
          <input type="text" id="image" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="/assets/images/posts/image.jpg">
        </div>

        <!-- Image Upload -->
        <div>
          <label for="imageFile" class="block text-sm font-medium text-gray-700 mb-2">Or Upload Featured Image</label>
          <input type="file" id="imageFile" accept="image/png,image/jpeg,image/webp,image/svg+xml" class="w-full text-sm text-gray-700 border border-dashed border-gray-300 rounded-lg cursor-pointer bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
          <p class="text-xs text-gray-500 mt-2">Images save to <code>/assets/images/posts/</code>. Use descriptive filenames under 1&nbsp;MB.</p>
          <div id="imagePreview" class="hidden mt-3 border border-gray-200 rounded-xl overflow-hidden"></div>
        </div>

        <!-- Image Alt -->
        <div>
          <label for="imageAlt" class="block text-sm font-medium text-gray-700 mb-2">Image Alt Text</label>
          <input type="text" id="imageAlt" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Describe what appears in the image">
        </div>

        <!-- Excerpt -->
        <div>
          <label for="excerpt" class="block text-sm font-medium text-gray-700 mb-2">Excerpt (Optional)</label>
          <textarea id="excerpt" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Brief summary of the article"></textarea>
        </div>

        <!-- Content -->
        <div>
          <label for="content" class="block text-sm font-medium text-gray-700 mb-2">Article Content (Markdown) *</label>
          <textarea id="content" required rows="15" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm" placeholder="Write your article content in Markdown format..."></textarea>
        </div>

        <!-- Status Messages -->
        <div id="uploadError" class="hidden p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg"></div>
        <div id="uploadSuccess" class="hidden p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg"></div>

        <!-- Submit Button -->
        <div class="flex gap-4">
          <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition">
            üì§ Publish Article
          </button>
          <button type="button" onclick="resetForm()" class="px-6 py-3 border border-gray-300 rounded-lg font-semibold hover:bg-gray-50 transition">
            Reset
          </button>
        </div>
      </form>
    </div>

  </div>
</div>

<script>
const OWNER = 'kundan007b';
const REPO = 'bhaskar-daily-ai-news';
const BRANCH = 'main';

const articleForm = document.getElementById('articleForm');
const imageFileInput = document.getElementById('imageFile');
const imagePreview = document.getElementById('imagePreview');
const imageAltInput = document.getElementById('imageAlt');
const imageUrlInput = document.getElementById('image');

// Authentication
// IMPORTANT: Change these credentials and consider using environment variables
// or GitHub OAuth for better security in production
const ADMIN_USER = 'kb007';
const ADMIN_PASS_HASH = 'a]k#9Zx!2pQ'; // Change this password!

function login() {
  const userId = document.getElementById('userId').value;
  const password = document.getElementById('password').value;
  const loginError = document.getElementById('loginError');
  
  // Simple client-side authentication (NOT secure for production)
  // TODO: Replace with GitHub OAuth or server-side auth
  if (userId === ADMIN_USER && password === ADMIN_PASS_HASH) {
    sessionStorage.setItem('isAuthenticated', 'true');
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('uploadSection').classList.remove('hidden');
    loginError.classList.add('hidden');
  } else {
    loginError.textContent = 'Invalid credentials. Please try again.';
    loginError.classList.remove('hidden');
  }
}

function logout() {
  sessionStorage.removeItem('isAuthenticated');
  sessionStorage.removeItem('githubToken');
  document.getElementById('loginSection').classList.remove('hidden');
  document.getElementById('uploadSection').classList.add('hidden');
  resetForm();
}

// Check authentication on load
window.addEventListener('DOMContentLoaded', function() {
  if (sessionStorage.getItem('isAuthenticated') === 'true') {
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('uploadSection').classList.remove('hidden');
  }
  
  const titleInput = document.getElementById('title');
  const slugInput = document.getElementById('slug');
  if (titleInput && slugInput) {
    titleInput.addEventListener('input', function() {
      const slug = sanitizeSlug(this.value);
      slugInput.value = slug;
    });
  }

  if (imageFileInput) {
    imageFileInput.addEventListener('change', handleImageSelection);
  }
});

// Form submission
articleForm.addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const uploadError = document.getElementById('uploadError');
  const uploadSuccess = document.getElementById('uploadSuccess');
  uploadError.classList.add('hidden');
  uploadSuccess.classList.add('hidden');
  
  try {
    const title = document.getElementById('title').value.trim();
    const slug = sanitizeSlug(document.getElementById('slug').value || title);
    const author = document.getElementById('author').value;
    const language = document.getElementById('language').value;
    const keywords = document.getElementById('keywords').value;
    const excerpt = document.getElementById('excerpt').value.trim();
    const content = document.getElementById('content').value.trim();
    const imageAlt = imageAltInput.value.trim();
    const manualImagePath = imageUrlInput.value.trim();
    
    if (!title) {
      throw new Error('Title is required');
    }
    if (!slug) {
      throw new Error('URL slug cannot be empty');
    }
    if (!content) {
      throw new Error('Article content is required');
    }

    // Get selected categories
    const categoryCheckboxes = document.querySelectorAll('input[name="category"]:checked');
    const categories = Array.from(categoryCheckboxes).map(cb => cb.value.trim()).filter(Boolean);
    if (categories.length === 0) {
      throw new Error('Please select at least one category');
    }
    
    // Create date string
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0];
    const timeStr = today.toTimeString().split(' ')[0];

    // GitHub token (prompt once)
    const token = await getGitHubToken();

    // Upload image if needed
    let finalImagePath = manualImagePath;
    if (!finalImagePath && imageFileInput.files.length > 0) {
      finalImagePath = await uploadImageFile(imageFileInput.files[0], slug, dateStr, token);
      imageUrlInput.value = finalImagePath;
    }
    if (!finalImagePath) {
      throw new Error('Add a featured image URL or upload a file.');
    }

    const keywordArray = keywords.split(',').map(k => k.trim()).filter(Boolean);

    // Build front matter
    let frontMatter = '---\n';
    frontMatter += `layout: post\n`;
    frontMatter += `title: "${sanitizeYaml(title)}"\n`;
    frontMatter += `description: "${sanitizeYaml(excerpt || title)}"\n`;
    frontMatter += `author: ${author}\n`;
    frontMatter += `categories: [${quoteArray(categories)}]\n`;
    frontMatter += `image: ${finalImagePath}\n`;
    if (imageAlt) {
      frontMatter += `image_alt: "${sanitizeYaml(imageAlt)}"\n`;
    }
    frontMatter += `lang: ${language}\n`;
    frontMatter += `date: ${dateStr}\n`;
    if (keywordArray.length > 0) {
      frontMatter += `news_keywords: [${quoteArray(keywordArray)}]\n`;
    }
    frontMatter += `tags: [${quoteArray(categories)}]\n`;
    if (excerpt) {
      frontMatter += `excerpt: "${sanitizeYaml(excerpt)}"\n`;
    }
    frontMatter += `last_modified_at: ${dateStr} ${timeStr} +05:30\n`;
    frontMatter += '---\n\n';
    
    const fullContent = frontMatter + content + '\n';
    const filename = `${dateStr}-${slug}.md`;
    
    await uploadArticleFile(filename, fullContent, token);
    
    uploadSuccess.innerHTML = `‚úÖ <strong>Article published successfully!</strong><br>Filename: ${filename}<br>GitHub Pages will rebuild in 1-2 minutes.`;
    uploadSuccess.classList.remove('hidden');
    
    setTimeout(() => {
      resetForm();
      uploadSuccess.classList.add('hidden');
    }, 5000);
    
  } catch (error) {
    uploadError.textContent = '‚ùå Error: ' + error.message;
    uploadError.classList.remove('hidden');
  }
});

async function uploadArticleFile(filename, content, token) {
  return uploadContentToGitHub({
    path: `_posts/${filename}`,
    content,
    token,
    createMessage: `Add article: ${filename}`,
    updateMessage: `Update article: ${filename}`
  });
}

async function uploadImageFile(file, slug, dateStr, token) {
  const allowed = ['png', 'jpg', 'jpeg', 'webp', 'svg'];
  const extFromName = (file.name.split('.').pop() || '').toLowerCase();
  const extension = allowed.includes(extFromName) ? extFromName : 'png';
  if (!allowed.includes(extFromName) && extFromName) {
    throw new Error('Unsupported image format. Use PNG, JPG, SVG, or WebP.');
  }

  const safeSlug = sanitizeSlug(slug);
  const filename = `${dateStr}-${safeSlug}.${extension}`;
  const base64Content = await fileToBase64(file);

  await uploadContentToGitHub({
    path: `assets/images/posts/${filename}`,
    content: base64Content,
    token,
    createMessage: `Add image: ${filename}`,
    updateMessage: `Update image: ${filename}`,
    isBase64: true
  });

  return `/assets/images/posts/${filename}`;
}

async function uploadContentToGitHub({ path, content, token, createMessage, updateMessage, isBase64 = false }) {
  const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${path}`;
  let sha = null;

  try {
    const checkResponse = await fetch(url, {
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json'
      }
    });

    if (checkResponse.ok) {
      const data = await checkResponse.json();
      sha = data.sha;
    }
  } catch (_) {
    // ignore 404 for new files
  }

  const payload = {
    message: sha ? updateMessage : createMessage,
    content: isBase64 ? content : btoa(unescape(encodeURIComponent(content))),
    branch: BRANCH
  };

  if (sha) {
    payload.sha = sha;
  }

  const response = await fetch(url, {
    method: 'PUT',
    headers: {
      'Authorization': `token ${token}`,
      'Accept': 'application/vnd.github.v3+json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(payload)
  });

  if (!response.ok) {
    if (response.status === 401) {
      sessionStorage.removeItem('githubToken');
      throw new Error('Invalid GitHub token. Please try again with a valid token.');
    }
    const error = await response.json().catch(() => ({}));
    throw new Error(error.message || 'Failed to upload to GitHub');
  }

  return response.json();
}

async function getGitHubToken() {
  let token = sessionStorage.getItem('githubToken');
  if (!token) {
    token = prompt('Enter your GitHub Personal Access Token (with repo permissions):\n\nCreate one at: https://github.com/settings/tokens\n\nPermissions needed: repo');
    if (!token) {
      throw new Error('GitHub token is required to upload content');
    }
    sessionStorage.setItem('githubToken', token.trim());
  }
  return token;
}

function handleImageSelection() {
  if (imageFileInput.files && imageFileInput.files[0]) {
    const file = imageFileInput.files[0];
    const reader = new FileReader();
    reader.onload = (event) => {
      imagePreview.innerHTML = `<img src="${event.target.result}" alt="Selected preview" class="w-full h-48 object-cover">`;
      imagePreview.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
  } else {
    clearImagePreview();
  }
}

function clearImagePreview() {
  if (!imagePreview) return;
  imagePreview.classList.add('hidden');
  imagePreview.innerHTML = '';
}

async function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const result = reader.result;
      const base64 = result.split(',')[1];
      resolve(base64);
    };
    reader.onerror = () => reject(new Error('Failed to read image file.'));
    reader.readAsDataURL(file);
  });
}

function sanitizeSlug(value) {
  return value
    .toLowerCase()
    .replace(/[^a-z0-9\s-]/g, '')
    .replace(/\s+/g, '-')
    .replace(/-+/g, '-')
    .replace(/^-+|-+$/g, '')
    .trim();
}

function sanitizeYaml(value = '') {
  return value.replace(/"/g, '\\"').replace(/\r?\n|\r/g, ' ').trim();
}

function quoteArray(items = []) {
  return items.map(item => `"${sanitizeYaml(item)}"`).join(', ');
}

function resetForm() {
  articleForm.reset();
  const checkboxes = document.querySelectorAll('input[name="category"]');
  checkboxes.forEach(cb => cb.checked = false);
  if (imageFileInput) {
    imageFileInput.value = '';
  }
  if (imageAltInput) {
    imageAltInput.value = '';
  }
  clearImagePreview();
}

// Handle Enter key on login
document.getElementById('userId').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') login();
});

document.getElementById('password').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') login();
});
</script>

<style>
/* Additional custom styles */
#uploadSection textarea {
  resize: vertical;
  min-height: 100px;
}

#imagePreview img {
  width: 100%;
  height: 12rem;
  object-fit: cover;
  display: block;
}

input:focus, textarea:focus, select:focus {
  outline: none;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
</style>
