<!-- Related Posts Section -->
{% if page.layout == "post" and page.categories %}
  {% assign related_posts = site.posts | where_exp: "post", "post.categories == page.categories" | where_exp: "post", "post.url != page.url" | slice: 0, 4 %}
  
  {% if related_posts.size > 0 %}
  <section style="margin-top: 4rem; padding-top: 3rem; border-top: 2px solid #dadce0;">
    <h2 style="font-size: 1.8rem; margin-bottom: 2rem; color: #202124;">
      üì∞ Related Articles
    </h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem;">
      {% for post in related_posts %}
        <article style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.15)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'">
          
          {% if post.image %}
            <a href="{{ post.url | relative_url }}" style="display: block;">
              <img src="{{ post.image | relative_url }}" alt="{{ post.title | escape }}" 
                   style="width: 100%; height: 180px; object-fit: cover; display: block;">
            </a>
          {% else %}
            <a href="{{ post.url | relative_url }}" style="display: block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 180px; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; text-decoration: none;">
              üì∞
            </a>
          {% endif %}
          
          <div style="padding: 1.5rem;">
            {% if post.category %}
              <span style="display: inline-block; padding: 0.25rem 0.75rem; background: rgba(26, 115, 232, 0.1); color: #1a73e8; border-radius: 4px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; margin-bottom: 0.75rem;">
                {{ post.category }}
              </span>
            {% endif %}
            
            <h3 style="font-size: 1.1rem; margin: 0.75rem 0; line-height: 1.4;">
              <a href="{{ post.url | relative_url }}" style="color: #202124; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='#1a73e8'" onmouseout="this.style.color='#202124'">
                {{ post.title | escape | truncate: 80 }}
              </a>
            </h3>
            
            <p style="color: #5f6368; font-size: 0.9rem; margin: 0.5rem 0;">
              üóìÔ∏è {{ post.date | date: "%b %d, %Y" }}
            </p>
            
            {% if post.excerpt %}
              <p style="color: #5f6368; font-size: 0.85rem; line-height: 1.5; margin-top: 0.75rem;">
                {{ post.excerpt | strip_html | truncate: 100 }}
              </p>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  </section>
  {% endif %}
{% endif %}
